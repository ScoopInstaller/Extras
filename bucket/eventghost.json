{
  "version": "0.4.1.r1722",
  "description": "EventGhost is an advanced, event-driven automation tool for Windows.",
  "homepage": "https://eventghost.net/",
  "license": "GPL-2.0",
  "architecture": {
    "64bit": {
      "url": "https://github.com/EventGhost/EventGhost/releases/download/v0.4.1.r1722/EventGhost_0.4.1.r1722_Setup.exe",
      "hash": "43824b90ccd778ba9b1780e0916548896a0287ce110aa98aecee0aa9d3cdcfb2"
    }
  },
"installer": {
  "script": [
    "$exe = \"$dir\\EventGhost_0.4.1.r1722_Setup.exe\"",
    "if (-not (Test-Path $exe)) { throw 'Installer not found' }",
    "$systemPF = [Environment]::GetFolderPath('ProgramFiles')",
    "$systemPFx86 = [Environment]::GetFolderPath('ProgramFilesX86')",
    "$userPrograms = Join-Path $env:LOCALAPPDATA 'Programs\\EventGhost'",
    "$systemDir = Join-Path $systemPF 'EventGhost'",
    "$systemDirX86 = Join-Path $systemPFx86 'EventGhost'",
    "# Try system install to Program Files",
    "Start-Process -FilePath $exe -ArgumentList @('/VERYSILENT','/SUPPRESSMSGBOXES','/NORESTART','/LOG=\"$env:TEMP\\EventGhost-install.log\"','/DIR=`\"$systemDir`\"') -Wait -NoNewWindow",
    "Start-Sleep -Seconds 2",
    "if (Test-Path (Join-Path $systemDir 'EventGhost.exe')) { exit 0 }",
    "# Try system install to Program Files (x86)",
    "Start-Process -FilePath $exe -ArgumentList @('/VERYSILENT','/SUPPRESSMSGBOXES','/NORESTART','/LOG=\"$env:TEMP\\EventGhost-install.log\"','/DIR=`\"$systemDirX86`\"') -Wait -NoNewWindow",
    "Start-Sleep -Seconds 2",
    "if (Test-Path (Join-Path $systemDirX86 'EventGhost.exe')) { exit 0 }",
    "# Fallback to per-user install",
    "Start-Process -FilePath $exe -ArgumentList @('/VERYSILENT','/SUPPRESSMSGBOXES','/NORESTART','/LOG=\"$env:TEMP\\EventGhost-install.log\"','/DIR=`\"$userPrograms`\"') -Wait -NoNewWindow",
    "Start-Sleep -Seconds 2",
    "if (-not (Test-Path (Join-Path $userPrograms 'EventGhost.exe'))) { throw 'Silent install failed: EventGhost executable not found in system or user paths' }"
  ]
},
"uninstaller": {
  "script": [
    "# Resolve folders",
    "$pf = [Environment]::GetFolderPath('ProgramFiles')",
    "$pf86 = [Environment]::GetFolderPath('ProgramFilesX86')",
    "$userDir = Join-Path $env:LOCALAPPDATA 'Programs\\EventGhost'",
    "# Stop running processes (best effort)",
    "Get-Process -Name EventGhost -ErrorAction SilentlyContinue | ForEach-Object { Try { Stop-Process -Id $_.Id -Force -ErrorAction Stop } Catch {} }",
    "Start-Sleep -Milliseconds 500",
    "taskkill /IM EventGhost.exe /F /T 2>$null",
    "Start-Sleep -Seconds 1",
    "# Locate uninstaller",
    "$candidates = @(Join-Path $pf 'EventGhost\\unins000.exe', Join-Path $pf86 'EventGhost\\unins000.exe', Join-Path $userDir 'unins000.exe')",
    "$unins = $candidates | Where-Object { Test-Path $_ } | Select-Object -First 1",
    "if ($unins) {",
    "  Start-Process -FilePath $unins -ArgumentList '/VERYSILENT','/SUPPRESSMSGBOXES','/NORESTART','/LOG=\"$env:TEMP\\EventGhost-uninstall.log\"' -Wait -NoNewWindow",
    "  Start-Sleep -Seconds 1",
    "  # Verify uninstall succeeded",
    "  $exePaths = @(Join-Path $pf 'EventGhost\\EventGhost.exe', Join-Path $pf86 'EventGhost\\EventGhost.exe', Join-Path $userDir 'EventGhost.exe')",
    "  if ($exePaths | Where-Object { Test-Path $_ }) {",
    "    # If still present, try to force remove files",
    "    Get-Process -Name EventGhost -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue",
    "    foreach ($p in $exePaths) { if (Test-Path $p) { Remove-Item -LiteralPath (Split-Path $p -Parent) -Recurse -Force -ErrorAction SilentlyContinue } }",
    "    if ($exePaths | Where-Object { Test-Path $_ }) { throw 'Uninstall incomplete: files remain after uninstaller and forced removal' }",
    "  }",
    "} else {",
    "  # No uninstaller found; attempt to remove installed folders as last resort",
    "  foreach ($p in @(Join-Path $pf 'EventGhost', Join-Path $pf86 'EventGhost', $userDir)) { if (Test-Path $p) { Get-Process -ErrorAction SilentlyContinue | Where-Object { $_.Path -like \"$p*\" } | Stop-Process -Force -ErrorAction SilentlyContinue; Remove-Item -LiteralPath $p -Recurse -Force -ErrorAction SilentlyContinue } }",
    "  if (Test-Path (Join-Path $pf 'EventGhost') -or Test-Path (Join-Path $pf86 'EventGhost') -or Test-Path $userDir) { throw 'Uninstall failed: uninstaller missing and forced removal incomplete' }",
    "}"
  ]
},
  "shortcuts": [
    [
      "EventGhost.exe",
      "EventGhost"
    ]
  ],
  "persist": [
    "config",
    "plugins"
  ],
  "checkver": {
    "github": "EventGhost/EventGhost"
  },
  "autoupdate": {
    "architecture": {
      "64bit": {
        "url": "https://github.com/EventGhost/EventGhost/releases/download/v$version/EventGhost_$version_Setup.exe"
      }
    }
  }
}

