{
    "version": "127.0.5778.64",
    "description": "A fast, secure, easy-to-use browser.",
    "homepage": "https://www.opera.com",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.opera.com/eula/computers"
    },
    "architecture": {
        "64bit": {
            "url": "https://get.geo.opera.com/pub/opera/desktop/127.0.5778.64/win/Opera_127.0.5778.64_Setup_x64.exe",
            "hash": "339edf56aa8ce4ed47a0b0cf052b5fb0bfaaa06e12911810f514eb348cc213a4"
        },
        "32bit": {
            "url": "https://get.geo.opera.com/pub/opera/desktop/127.0.5778.64/win/Opera_127.0.5778.64_Setup.exe",
            "hash": "7c3625f078ca44a1c7072575cdb0793e1197e9a91f77ea3669685b69cb0c66e1"
        },
        "arm64": {
            "url": "https://get.geo.opera.com/pub/opera/desktop/127.0.5778.64/win/Opera_127.0.5778.64_Setup_arm64.exe",
            "hash": "6d0188bb34e688276f7ff3b49de607905eb708da36bf0172b78dd0690550ab77"
        }
    },
    "installer": {
        "script": [
            "Expand-7zipArchive -Path \"$dir\\$fname\" -DestinationPath $dir -Removal",
            "$version, 'autoupdate' | ForEach-Object { ensure \"$dir\\$_\" | Out-Null }",
            "Move-Item -Path \"$dir\\opera_autoupdate*\" -Destination \"$dir\\autoupdate\" -Force",
            "Remove-Item -Path \"$dir\\*\" -Include '*_list' -Force -ErrorAction SilentlyContinue",
            "$exclude_list = @('Assets', $version, 'autoupdate', 'Resources.pri', 'opera.visualelementsmanifest.xml')",
            "Get-ChildItem -Path $dir | Where-Object { $exclude_list -notcontains $_.Name } | ForEach-Object {",
            "    Move-Item -Path $_.FullName -Destination \"$dir\\$version\\$($_.Name)\" -Force -ErrorAction SilentlyContinue",
            "}",
            "Copy-Item -Path \"$dir\\$version\\opera.exe\" -Destination $dir",
            "$cfg = @{ 'autoupdate'= $false; 'enable_stats' = $false; 'single_profile' = $true } | ConvertTo-Json -Depth 5",
            "Set-Content -Path \"$dir\\installer_prefs.json\" -Value $cfg -Encoding ascii"
        ]
    },
    "shortcuts": [
        [
            "opera.exe",
            "Opera"
        ]
    ],
    "persist": "profile",
    "checkver": {
        "script": [
            "$path_regex = '^(?!\\.)[\\d.]+/$'",
            "$version_sort = { [version]$_.href.TrimEnd('/') }",
            "$releases_url = 'https://get.geo.opera.com/pub/opera/desktop/'",
            "$releases_page = Invoke-WebRequest -Uri $releases_url -UseBasicParsing -ErrorAction Stop",
            "$path_segments = $releases_page.links | Where-Object { $_.href -match $path_regex } |",
            "        Sort-Object -Property $version_sort -Descending | ForEach-Object -MemberName href",
            "foreach ($path_segment in $path_segments.TrimEnd('/')) {",
            "    $release_url = 'https://get.geo.opera.com/pub/opera/desktop/{0}/win/' -f $path_segment",
            "    $download_page = Invoke-WebRequest -Uri $release_url -UseBasicParsing -ErrorAction Stop",
            "    $installer_name = $download_page.Links | Where-Object { $_.href -match '(?<=Setup\\w+)\\.exe$' } |",
            "            Select-Object -ExpandProperty href -First 1",
            "    if ($null -ne $installer_name) { Write-Output $installer_name; break }",
            "}"
        ],
        "regex": "Opera_([\\d.]+)_Setup"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://get.geo.opera.com/pub/opera/desktop/$version/win/Opera_$version_Setup_x64.exe"
            },
            "32bit": {
                "url": "https://get.geo.opera.com/pub/opera/desktop/$version/win/Opera_$version_Setup.exe"
            },
            "arm64": {
                "url": "https://get.geo.opera.com/pub/opera/desktop/$version/win/Opera_$version_Setup_arm64.exe"
            }
        },
        "hash": {
            "url": "$url.sha256sum"
        }
    }
}
