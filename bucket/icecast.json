{
    "version": "2.4.3",
    "description": "A streaming media (audio/video) server which supports Ogg (Vorbis and Theora), Opus, WebM and MP3 streams.",
    "homepage": "https://icecast.org/",
    "license": "GPL-2.0-only",
    "url": "https://ftp.osuosl.org/pub/xiph/releases/icecast/icecast_win32_2.4.3.exe#/dl.7z",
    "hash": "603bb7c94a9248ac104ef84c3e8472949db8bd3c2fcc4ff7a7a34ee98057efe0",
    "depends": "nssm",
    "notes": "Run \"$dir\\install-service.bat\" under Admin to install IceCast as Windows service.",
    "pre_install": [
        "Remove-Item \"$dir\\`$PLUGINSDIR\", \"$dir\\Uninstall.exe\" -Force -Recurse",
        "'log\\access.log', 'log\\error.log', 'log\\playlist.log' | ForEach-Object {",
        "    if(!(Test-Path \"$persist_dir\\$_\")) { New-Item \"$dir\\$_\" -Force | Out-Null }",
        "}",
        "Set-Content \"$dir\\icecast-scoop-start.bat\" \"@echo off`r`ncd /d %~dp0`r`nicecast.bat\" -Encoding Ascii"
    ],
    "post_install": [
        "Set-Content \"$dir\\install-service.bat\"  \"@echo off`r`nnssm install IceCast `\"$dir\\icecast-scoop-start.bat`\"`r`nnet start IceCast\" -Encoding Ascii",
        "Set-Content \"$dir\\uninstall-service.bat\"  \"@echo off`r`nsc delete IceCast\" -Encoding Ascii"
    ],
    "uninstaller": {
        "script": [
            "# uninstall IceCast service if the user uninstalls the app, but not updates the app",
            "if ($cmd -eq 'uninstall') {",
            "    sc.exe query IceCast | Out-Null",
            "    if ($LASTEXITCODE -eq 0) {",
            "        if(!(is_admin)) { error 'Admin right is required to uninstall IceCast service'; break }",
            "        sc.exe delete IceCast",
            "    }",
            "}"
        ]
    },
    "bin": [
        [
            "icecast-scoop-start.bat",
            "icecast"
        ]
    ],
    "persist": [
        "admin",
        "log",
        "icecast.xml"
    ],
    "checkver": {
        "url": "https://api.github.com/repos/xiph/Icecast-Server/tags",
        "regex": "v([\\d.]+)\""
    },
    "autoupdate": {
        "url": "https://ftp.osuosl.org/pub/xiph/releases/icecast/icecast_win32_$version.exe#/dl.7z"
    }
}
