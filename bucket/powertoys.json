{
    "version": "0.97.2",
    "description": "A set of utilities for power users to tune and streamline their Windows experience for greater productivity.",
    "homepage": "https://github.com/microsoft/PowerToys",
    "license": {
        "identifier": "MIT",
        "url": "https://github.com/microsoft/PowerToys/blob/HEAD/LICENSE"
    },
    "notes": [
        "To register the context menu entry, please execute the following command:",
        "Invoke-Expression -Command \"& `\"$dir\\install-context.ps1`\"\"",
        "",
        "Please note that the related logic has been changed.",
        "The context menu must be re-registered once, even if it was previously registered.",
        "No further action is required if this message appears again."
    ],
    "architecture": {
        "64bit": {
            "url": "https://github.com/microsoft/PowerToys/releases/download/v0.97.2/PowerToysUserSetup-0.97.2-x64.exe",
            "hash": "54a39f62334f7481c1bdde8abf4928f2e74f100a049f50c7339dabfd34134c98"
        },
        "arm64": {
            "url": "https://github.com/microsoft/PowerToys/releases/download/v0.97.2/PowerToysUserSetup-0.97.2-arm64.exe",
            "hash": "bb24aee4b0b8ebdc007d04a84843d44008ab585192cf145816f4c07c99251be0"
        }
    },
    "installer": {
        "script": [
            "Expand-DarkArchive -Path \"$dir\\$fname\" -DestinationPath \"$dir\\tmp\" -Removal",
            "$installer_file = Get-ChildItem -Path \"$dir\\tmp\\AttachedContainer\" -Filter '*.msi' -File",
            "[xml]$xml = Get-Content -Path \"$dir\\tmp\\UX\\manifest.xml\" -Encoding utf8",
            "$engine_version = $xml.BurnManifest.EngineVersion",
            "if ($null -ne $engine_version -and [version]$engine_version -ge [version]::new(5, 0)) {",
            "    Expand-MsiArchive -Path $installer_file.FullName -DestinationPath $dir -ExtractDir 'LocalApp\\PowerToys'",
            "} else {",
            "    Expand-MsiArchive -Path $installer_file.FullName -DestinationPath $dir -ExtractDir 'PowerToys'",
            "}",
            "Remove-Item -Path \"$dir\\tmp\" -Recurse -Force -ErrorAction SilentlyContinue"
        ]
    },
    "post_install": [
        "$install_scope, $registry_scope = if ($global) { 'perMachine', 'HKLM' } else { 'perUser', 'HKCU' }",
        "Get-ChildItem -Path \"$bucketsdir\\$bucket\\scripts\\$app\" -Filter '*.ps1' -File | ForEach-Object {",
        "    $content = Get-Content -Path $_.FullName -Encoding utf8",
        "    $content = $content -Replace '{{install_scope}}', $install_scope",
        "    $content = $content -Replace '{{registry_scope}}', $registry_scope",
        "    $content -Replace '{{powertoys_dir}}', $original_dir | Set-Content -Path \"$dir\\$($_.Name)\" -Encoding utf8",
        "}",
        "$registry_path = \"${registry_scope}:\\Software\\Classes\\powertoys\"",
        "if (-not (Test-Path -Path $registry_path)) { return }",
        "$default_value = Get-ItemProperty -Path $registry_path | ForEach-Object -MemberName '(default)'",
        "if ($null -ne $default_value -and $default_value -eq 'Context menu registration status check') {",
        "    Invoke-Expression -Command \"& `\"$dir\\install-context.ps1`\"\"",
        "}"
    ],
    "shortcuts": [
        [
            "PowerToys.exe",
            "PowerToys"
        ]
    ],
    "uninstaller": {
        "script": [
            "$registry_scope = if ($global) { 'HKLM' } else { 'HKCU' }",
            "$registry_path = \"${registry_scope}:\\Software\\Classes\\powertoys\"",
            "if (-not (Test-Path -Path $registry_path)) { return }",
            "$default_value = Get-ItemProperty -Path $registry_path | ForEach-Object -MemberName '(default)'",
            "if ($default_value -ne 'URL:PowerToys custom internal URI protocol') { return }",
            "Invoke-Expression -Command \"& `\"$dir\\uninstall-context.ps1`\"\"",
            "if ($cmd -eq 'uninstall') {",
            "    $remove_list = @($registry_path, 'HKCU:\\Software\\Classes\\powertoys')",
            "    $remove_list | Remove-Item -Recurse -Force -ErrorAction SilentlyContinue",
            "} else {",
            "    $default_value = 'Context menu registration status check'",
            "    Set-ItemProperty -Path $registry_path -Name '(default)' -Value $default_value -Force",
            "}",
            "Stop-Process -Name 'explorer' -Force -ErrorAction SilentlyContinue",
            "Start-Sleep -Milliseconds 1500"
        ]
    },
    "checkver": {
        "url": "https://api.github.com/repositories/184456251/releases",
        "jsonpath": "$[?(@.prerelease == false)].assets[?(@.name =~ /PowerToysUser/i)].browser_download_url",
        "regex": "(?i)download/(?<tag>[^/]+)/PowerToysUserSetup-([\\d.]+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://github.com/microsoft/PowerToys/releases/download/v$version/PowerToysUserSetup-$version-x64.exe"
            },
            "arm64": {
                "url": "https://github.com/microsoft/PowerToys/releases/download/v$version/PowerToysUserSetup-$version-arm64.exe"
            }
        },
        "hash": {
            "url": "https://github.com/microsoft/PowerToys/releases/tag/v$version",
            "regex": "(?s)$basename.+?$sha256"
        }
    }
}
