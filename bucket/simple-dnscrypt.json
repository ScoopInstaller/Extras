{
    "version": "0.7.1",
    "description": "A simple management tool to configure dnscrypt-proxy on windows based systems.",
    "homepage": "https://simplednscrypt.org",
    "license": {
        "identifier": "MIT",
        "url": "https://github.com/bitbeans/SimpleDnsCrypt/blob/HEAD/LICENSE.md"
    },
    "suggest": {
        "Microsoft Visual C++ 2015-2022 Redistributable": "extras/vcredist2022"
    },
    "architecture": {
        "64bit": {
            "url": "https://github.com/bitbeans/SimpleDnsCrypt/releases/download/0.7.1/SimpleDNSCrypt64.msi",
            "hash": "5ba0c94774acd7ade18446b4351e7d28a948c490aefc50dc6c08c13551f19f7f"
        },
        "32bit": {
            "url": "https://github.com/bitbeans/SimpleDnsCrypt/releases/download/0.7.1/SimpleDNSCrypt.msi",
            "hash": "cac6b8119af3da70a5977a2e73ee5214303990fedd7abbc5f247a1e2cf19a663"
        }
    },
    "pre_install": [
        "if (Test-Path -Path \"$dir\\APPDIR\" -PathType Container) {",
        "    Copy-Item -Path \"$dir\\APPDIR\\*\" -Destination $dir -Force -Recurse",
        "    Remove-Item -Path \"$dir\\APPDIR\" -Recurse -Force -ErrorAction SilentlyContinue",
        "}",
        "'*.log', '*.txt' | ForEach-Object {",
        "    if (Test-Path -Path \"$persist_dir\\$_\" -PathType Leaf) {",
        "        Copy-Item -Path \"$persist_dir\\$_\" -Destination \"$dir\\dnscrypt-proxy\" -Force",
        "    }",
        "}"
    ],
    "shortcuts": [
        [
            "SimpleDnsCrypt.exe",
            "Simple DnsCrypt"
        ]
    ],
    "persist": "dnscrypt-proxy\\dnscrypt-proxy.toml",
    "pre_uninstall": [
        "'*.log', '*.txt' | ForEach-Object {",
        "    if (Test-Path -Path \"$dir\\dnscrypt-proxy\\$_\" -PathType Leaf) {",
        "        Copy-Item -Path \"$dir\\dnscrypt-proxy\\$_\" -Destination $persist_dir -Force",
        "    }",
        "}"
    ],
    "uninstaller": {
        "script": [
            "$base_service_name = 'dnscrypt-proxy'",
            "$path_regex = [regex]::Escape((Split-Path -Path $dir -Parent))",
            "Stop-Process -Name 'SimpleDnsCrypt' -Force -ErrorAction SilentlyContinue",
            "if ($PSVersionTable.PSVersion -ge [version]::new(6, 0)) {",
            "    $services = Get-Service -Name \"*$base_service_name*\" -ErrorAction SilentlyContinue",
            "} else {",
            "    $name_filter = \"Name like '%$base_service_name%'\"",
            "    $services = Get-CimInstance -ClassName Win32_Service -Filter $name_filter -ErrorAction SilentlyContinue |",
            "            Select-Object -Property *, @{ Name = 'BinaryPathName'; Expression = { $_.PathName } }",
            "}",
            "$service = $services | Where-Object { $_.BinaryPathName -match $path_regex }",
            "if ($null -ne $service) {",
            "    if (-not (is_admin)) { abort \"`n[ERROR]  $app requires admin rights to $cmd.\" }",
            "    Stop-Service -Name $service.Name -Force -ErrorAction SilentlyContinue",
            "    Stop-Process -Name 'dnscrypt-proxy' -Force -ErrorAction SilentlyContinue",
            "    Start-Sleep -Milliseconds 1500",
            "    if ($cmd -ne 'uninstall') { return }",
            "    if ($PSVersionTable.PSVersion -ge [version]::new(6, 0)) {",
            "        Remove-Service -Name 'dnscrypt-proxy' -ErrorAction SilentlyContinue",
            "    } else {",
            "        Start-Process -FilePath 'sc.exe' -ArgumentList @('delete', 'dnscrypt-proxy') -NoNewWindow -Wait",
            "    }",
            "}"
        ]
    },
    "checkver": {
        "github": "https://github.com/bitbeans/SimpleDnsCrypt"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://github.com/bitbeans/SimpleDnsCrypt/releases/download/$version/SimpleDNSCrypt64.msi"
            },
            "32bit": {
                "url": "https://github.com/bitbeans/SimpleDnsCrypt/releases/download/$version/SimpleDNSCrypt.msi"
            }
        }
    }
}
