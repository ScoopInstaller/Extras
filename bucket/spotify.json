{
    "version": "1.2.64.408.g0a9b557c",
    "description": "A digital music service that gives you access to millions of songs.",
    "homepage": "https://www.spotify.com/",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.spotify.com/legal/end-user-agreement/"
    },
    "architecture": {
        "64bit": {
            "url": "https://download.scdn.co/SpotifyFullSetupX64.exe",
            "hash": "13f92295abf1c5be86891c5396bf8e328ee4f3b55bdf89d213d6e4d5cbdadbe4"
        },
        "arm64": {
            "url": "https://download.scdn.co/SpotifyFullSetupARM64.exe",
            "hash": "5833f81a53b471b90bfc1026b81d6cedec7d7aac84e7e62771508a14464f7671"
        }
    },
    "installer": {
        "script": [
            "Start-Process -Wait \"$dir\\$fname\" -ArgumentList '/extract', \"`\"$dir`\"\"",
            "## Blocking the built-in autoupdater ##",
            "# Delete any remnant file or directory called Update, if present (first grant delete privileges to self)",
            "    $updateFile = \"$env:LOCALAPPDATA\\Spotify\\Update\"",
            "    icacls \"$updateFile\" /grant \"${env:username}:D\" /c 2>&1 | Out-Null",
            "    Remove-Item -Recurse -Force \"$updateFile\" -ErrorAction SilentlyContinue | Out-Null",
            "# Create a readonly file called Update and deny delete privileges to self",
            "    New-Item -Path \"$updateFile\" -ItemType File -Value \"Created by Scoop to block the built-in autoupdater.\" -Force -ErrorAction SilentlyContinue | Out-Null",
            "    Set-ItemProperty -Path \"$updateFile\" -Name IsReadOnly -Value $true -ErrorAction SilentlyContinue | Out-Null",
            "    icacls \"$updateFile\" /deny \"${env:username}:D\" /c 2>&1 | Out-Null",
            "Remove-Item \"$dir\\$fname\", \"$dir\\SpotifyMigrator.exe\" -ErrorAction SilentlyContinue"
        ]
    },
    "shortcuts": [
        [
            "Spotify.exe",
            "Spotify"
        ]
    ],
    "uninstaller": {
        "script": [
            "# Delete any remnant file or directory called Update, if present (first grant delete privileges to self)",
            "    $updateFile = \"$env:LOCALAPPDATA\\Spotify\\Update\"",
            "    icacls \"$updateFile\" /grant \"${env:username}:D\" /c 2>&1 | Out-Null",
            "    Remove-Item -Recurse -Force \"$updateFile\" -ErrorAction SilentlyContinue | Out-Null",
            "if ($cmd -ne 'uninstall') { return }",
            "Start-Process -Wait \"$dir\\Spotify.exe\" -ArgumentList '/Uninstall', '/Silent'"
        ]
    },
    "checkver": {
        "script": [
            "$dl_url = 'https://download.scdn.co/SpotifyFullSetupX64.exe'",
            "$dl = cache_path 'spotify' 'unknown' $dl_url",
            "Invoke-WebRequest $dl_url -OutFile $dl",
            "$ver = (Get-Item $dl).VersionInfo.ProductVersion",
            "Move-Item -Force $dl (cache_path 'spotify' $ver $dl_url)",
            "$ver"
        ],
        "regex": "(\\S+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://download.scdn.co/SpotifyFullSetupX64.exe"
            },
            "arm64": {
                "url": "https://download.scdn.co/SpotifyFullSetupARM64.exe"
            }
        }
    }
}
